using System.Xml;
using System.Security.Claims;
using System.Collections.Generic;

namespace WsFederation.Console
{
    public class Program
    {
        public static void Main(string[] args)
        {
            var inf = "<?xml version='1.0' encoding='UTF-8'?><wst:RequestSecurityTokenResponseCollection xmlns:wst='http://docs.oasis-open.org/ws-sx/ws-trust/200512' xmlns:ds='http://www.w3.org/2000/09/xmldsig#' xmlns:md='urn:oasis:names:tc:SAML:2.0:metadata' xmlns:saml2='urn:oasis:names:tc:SAML:2.0:assertion' xmlns:wsa='http://www.w3.org/2005/08/addressing' xmlns:wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd' xmlns:wsu='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd' xmlns:xenc='http://www.w3.org/2001/04/xmlenc#'><wst:RequestSecurityTokenResponse><wst:TokenType>urn:oasis:names:tc:SAML:2.0:assertion</wst:TokenType><wst:RequestType>http://docs.oasis-open.org/ws-sx/ws-trust/200512/Issue</wst:RequestType><wst:KeyType>http://docs.oasis-open.org/ws-sx/ws-trust/200512/Bearer</wst:KeyType><wst:RequestedSecurityToken><saml2:Assertion xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' ID='assertion-8b25920a-6ea6-4806-8097-43d492fe786e' IssueInstant='2016-07-13T19:29:50.446Z' Version='2.0' xmlns:saml2='urn:oasis:names:tc:SAML:2.0:assertion'><saml2:Issuer>www.e-contract.be</saml2:Issuer><ds:Signature xmlns:ds='http://www.w3.org/2000/09/xmldsig#'><ds:SignedInfo><ds:CanonicalizationMethod Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#' /><ds:SignatureMethod Algorithm='http://www.w3.org/2000/09/xmldsig#rsa-sha1' /><ds:Reference URI='#assertion-8b25920a-6ea6-4806-8097-43d492fe786e'><ds:Transforms><ds:Transform Algorithm='http://www.w3.org/2000/09/xmldsig#enveloped-signature' /><ds:Transform Algorithm='http://www.w3.org/2001/10/xml-exc-c14n#' /></ds:Transforms><ds:DigestMethod Algorithm='http://www.w3.org/2000/09/xmldsig#sha1' /><ds:DigestValue>CVZVmqXDRmF8M7eL0BQIjvfNUrg=</ds:DigestValue></ds:Reference></ds:SignedInfo><ds:SignatureValue>W4zZL4x9qMJxlgwl0Vr45BcI4q3CQMR7fW7aX3iysFFL01x+2q+ASpDiE96dNV8N2epGpds3uYxml9DCeQQRHFaxwC+LyK+oyvr0IjS9Nj5d3R2Tv4zAQ0avW9hItNMEJf0BsFf0qsEqCJcQ0fH/r3/dO6lnMLrpW1leOAh1wvg5suw+LIZ3yI4Kb4Xzm3FlqaQAwk6rsqGc0AB5Ni4WdFhq5IbMU2VJ+uOi12hjeMRP4Y9q8FGhwkbguOq1A1sFWrpmHkj/rXAwM66iaSYpQaakOA8nsom6t4e1oPdFEo0zJdQAJk+SMBXGOH+rTkNkzppjOsJT1qoUnE82R8x1vQ==</ds:SignatureValue><ds:KeyInfo><ds:X509Data><ds:X509Certificate>MIIFLTCCBBWgAwIBAgIHS2X8ooaaSzANBgkqhkiG9w0BAQsFADCBtDELMAkGA1UEBhMCVVMxEDAOBgNVBAgTB0FyaXpvbmExEzARBgNVBAcTClNjb3R0c2RhbGUxGjAYBgNVBAoTEUdvRGFkZHkuY29tLCBJbmMuMS0wKwYDVQQLEyRodHRwOi8vY2VydHMuZ29kYWRkeS5jb20vcmVwb3NpdG9yeS8xMzAxBgNVBAMTKkdvIERhZGR5IFNlY3VyZSBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkgLSBHMjAeFw0xNDA0MTEwNDI4MzJaFw0xNzA0MTEwNDI4MzJaMD8xITAfBgNVBAsTGERvbWFpbiBDb250cm9sIFZhbGlkYXRlZDEaMBgGA1UEAxMRd3d3LmUtY29udHJhY3QuYmUwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC4KtCOOfoeW4HxyKxjRNf0DtXYyI60D/CrB3zoiWlvbNhbQuQeui5HSzDbo90FgOMQE7OGlaC+TInePOVlmPaMjBn1ZvkmI8q1Y2QBu3Rf8gEIMFQorsPKUx69YiUEy94sguSFPmxvCevbREHhPvAL6xfAEZuJyGlGIppkTOZ+AIT8+1HpT5MFX78CxwbIm5GR6mzMCONk+gEd1GdcSOBsXckWDmMVEKoat6OKYF/twuP2cHqqD9WXOkUL347n7q5jUbbuJlcMa1Io9GNoLK5RYMWhIMjqp4gLT2xg2QVd6kqtQX9xzvypYn7wpkysg4zZ3hRr1sCU18nHsBreuR6/AgMBAAGjggG2MIIBsjAPBgNVHRMBAf8EBTADAQEAMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAOBgNVHQ8BAf8EBAMCBaAwNgYDVR0fBC8wLTAroCmgJ4YlaHR0cDovL2NybC5nb2RhZGR5LmNvbS9nZGlnMnMxLTQwLmNybDBTBgNVHSAETDBKMEgGC2CGSAGG/W0BBxcBMDkwNwYIKwYBBQUHAgEWK2h0dHA6Ly9jZXJ0aWZpY2F0ZXMuZ29kYWRkeS5jb20vcmVwb3NpdG9yeS8wdgYIKwYBBQUHAQEEajBoMCQGCCsGAQUFBzABhhhodHRwOi8vb2NzcC5nb2RhZGR5LmNvbS8wQAYIKwYBBQUHMAKGNGh0dHA6Ly9jZXJ0aWZpY2F0ZXMuZ29kYWRkeS5jb20vcmVwb3NpdG9yeS9nZGlnMi5jcnQwHwYDVR0jBBgwFoAUQMK9J47MNIMwojPX+2yz8LQsgM4wKwYDVR0RBCQwIoIRd3d3LmUtY29udHJhY3QuYmWCDWUtY29udHJhY3QuYmUwHQYDVR0OBBYEFKlGMfaulaBUuzpcxgjLT5hJtJjaMA0GCSqGSIb3DQEBCwUAA4IBAQClS6PGpIgNL4OTAxfi3TNnplf6KdJFqMgeYFot9gGrJui2Mw6LI6DrVNscrlqEKvoluUYLRTS3M0b1DPT7t3pniOkDVWj/hYwjapIePVwcYq3j/SpVwd0IPbD+tDcvYhZya2GWLlDbxREG09677U6pQUomQCpkAyL6/9rd8nZIp5sjEAn06U50L1tQdHYbYp11pyJgaIYy+/cnPhoPuYxddZj5U1tU0F6ZirlF0RheRiY48ZsRBNM2lfl+InsxwmrSI/dZ+zqD2S395obTtiI+SG6irUHcHOY1P45fmqXDXDWzx9ES/WN5hy5Kyeypjp3k4gJbKzq9FWI2ufX11759</ds:X509Certificate></ds:X509Data></ds:KeyInfo></ds:Signature><saml2:Subject><saml2:NameID>89100739573</saml2:NameID><saml2:SubjectConfirmation Method='urn:oasis:names:tc:SAML:2.0:cm:bearer' /></saml2:Subject><saml2:Conditions NotBefore='2016-07-13T19:29:50.446Z' NotOnOrAfter='2016-07-13T19:34:50.446Z'><saml2:AudienceRestriction><saml2:Audience>http://localhost:5101/api/clients</saml2:Audience></saml2:AudienceRestriction></saml2:Conditions><saml2:AttributeStatement><saml2:Attribute Name='be:fedict:eid:idp:dob:year'><saml2:AttributeValue xmlns:xs='http://www.w3.org/2001/XMLSchema' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:type='xs:string'>1989</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name='be:fedict:eid:idp:dob:month'><saml2:AttributeValue xmlns:xs='http://www.w3.org/2001/XMLSchema' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:type='xs:string'>10</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name='be:fedict:eid:idp:card-validity:begin'><saml2:AttributeValue xmlns:xs='http://www.w3.org/2001/XMLSchema' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:type='xs:dateTime'>2014-01-30T00:00:00Z</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name='http://schemas.xmlsoap.org/ws/2005/05/identity/claims/locality'><saml2:AttributeValue xmlns:xs='http://www.w3.org/2001/XMLSchema' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:type='xs:string'>Bruxelles</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name='be:fedict:eid:idp:card-validity:end'><saml2:AttributeValue xmlns:xs='http://www.w3.org/2001/XMLSchema' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:type='xs:dateTime'>2019-01-30T00:00:00Z</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name='be:fedict:eid:idp:card-number'><saml2:AttributeValue xmlns:xs='http://www.w3.org/2001/XMLSchema' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:type='xs:string'>B174798747</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name='http://schemas.xmlsoap.org/ws/2005/05/identity/claims/privatepersonalidentifier'><saml2:AttributeValue xmlns:xs='http://www.w3.org/2001/XMLSchema' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:type='xs:string'>89100739573</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name='be:fedict:eid:idp:nationality'><saml2:AttributeValue xmlns:xs='http://www.w3.org/2001/XMLSchema' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:type='xs:string'>France</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name='be:fedict:eid:idp:cert:authn'><saml2:AttributeValue xmlns:xs='http://www.w3.org/2001/XMLSchema' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:type='xs:base64Binary'>MIID7zCCAtegAwIBAgIQEAAAAAAAjzo9FBi9BAvSgTANBgkqhkiG9w0BAQUFADA1MQswCQYDVQQGEwJCRTEVMBMGA1UEAxMMRm9yZWlnbmVyIENBMQ8wDQYDVQQFEwYyMDE0MDIwHhcNMTQwMjA1MTIzMzEyWhcNMTkwMTMwMjM1OTU5WjB3MQswCQYDVQQGEwJGUjEoMCYGA1UEAxMfVGhpZXJyeSBIYWJhcnQgKEF1dGhlbnRpY2F0aW9uKTEPMA0GA1UEBBMGSGFiYXJ0MRcwFQYDVQQqEw5UaGllcnJ5IFJvYmVydDEUMBIGA1UEBRMLODkxMDA3Mzk1NzMwgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAI4At/6KxOpRKiFEluuMVRaP+YI4gKKeVpl10CY+vPln9P3dvUh7gdNWfEN2Fn0LzvOslVDWZeb+A8/HBhPePpTJ9sACPJG+BjcLKZYKwjc6eEKAHmDTqClTuvrSi5hzpEuDJ7gHQmzJcochdcKRr06MIg3wP7P8s91VxSJoKJ0/AgMBAAGjggE7MIIBNzAfBgNVHSMEGDAWgBTD/rhgVgSUYRHFYhTWJlYgS27SvTBwBggrBgEFBQcBAQRkMGIwNgYIKwYBBQUHMAKGKmh0dHA6Ly9jZXJ0cy5laWQuYmVsZ2l1bS5iZS9iZWxnaXVtcnMyLmNydDAoBggrBgEFBQcwAYYcaHR0cDovL29jc3AuZWlkLmJlbGdpdW0uYmUvMjBEBgNVHSAEPTA7MDkGB2A4CQEBBwIwLjAsBggrBgEFBQcCARYgaHR0cDovL3JlcG9zaXRvcnkuZWlkLmJlbGdpdW0uYmUwOQYDVR0fBDIwMDAuoCygKoYoaHR0cDovL2NybC5laWQuYmVsZ2l1bS5iZS9laWRmMjAxNDAyLmNybDAOBgNVHQ8BAf8EBAMCB4AwEQYJYIZIAYb4QgEBBAQDAgWgMA0GCSqGSIb3DQEBBQUAA4IBAQBSz7layb5HgSQM+ZB2np1/gAUJ+8wuxoU62vxGrj7T1K5tmRK5WeX4rpEJ8h0Nv1169GGng77xlAdE9s8noQXQ063SuBg/QAXSYTRF2T+g9rZinC12aljo/bLz8jWSBY8AM4GZQcVAQ31aD+mWzO0DPwVtDvhl0/6jFVprKFDhAnPJvzMQe7a6zwi5lL+GXIKrnNhlvfQDtxJRV4Jr1vps7ZBjXnAOuatMIxlJ9eafU3dgQ2TvTpwSVDV8UgrInhKD9cLBzymli4LeMWyD6qC3SwfDwRVODqNSIogBnSH91fn3nZUDKpUYfOCSGxNozGYZsVnqwO0jJf4E69O5lUgg</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name='http://schemas.xmlsoap.org/ws/2005/05/identity/claims/dateofbirth'><saml2:AttributeValue xmlns:xs='http://www.w3.org/2001/XMLSchema' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:type='xs:dateTime'>1989-10-07T00:00:00Z</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name='http://schemas.xmlsoap.org/ws/2005/05/identity/claims/gender'><saml2:AttributeValue xmlns:xs='http://www.w3.org/2001/XMLSchema' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:type='xs:string'>1</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name='be:fedict:eid:idp:pob'><saml2:AttributeValue xmlns:xs='http://www.w3.org/2001/XMLSchema' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:type='xs:string'>Rambouillet</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name='http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname'><saml2:AttributeValue xmlns:xs='http://www.w3.org/2001/XMLSchema' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:type='xs:string'>Thierry Robert</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name='be:fedict:eid:idp:photo'><saml2:AttributeValue xmlns:xs='http://www.w3.org/2001/XMLSchema' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:type='xs:base64Binary'>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</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name='http://schemas.xmlsoap.org/ws/2005/05/identity/claims/streetaddress'><saml2:AttributeValue xmlns:xs='http://www.w3.org/2001/XMLSchema' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:type='xs:string'>Avenue des Croix du Feu 223 </saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name='be:e-contract:eid:idp:document-type'><saml2:AttributeValue xmlns:xs='http://www.w3.org/2001/XMLSchema' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:type='xs:string'>FOREIGNER_E</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name='http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name'><saml2:AttributeValue xmlns:xs='http://www.w3.org/2001/XMLSchema' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:type='xs:string'>Thierry Robert Habart</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name='http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname'><saml2:AttributeValue xmlns:xs='http://www.w3.org/2001/XMLSchema' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:type='xs:string'>Habart</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name='be:fedict:eid:idp:dob:day'><saml2:AttributeValue xmlns:xs='http://www.w3.org/2001/XMLSchema' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:type='xs:string'>7</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name='be:fedict:eid:idp:age'><saml2:AttributeValue xmlns:xs='http://www.w3.org/2001/XMLSchema' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:type='xs:integer'>26</saml2:AttributeValue></saml2:Attribute><saml2:Attribute Name='http://schemas.xmlsoap.org/ws/2005/05/identity/claims/postalcode'><saml2:AttributeValue xmlns:xs='http://www.w3.org/2001/XMLSchema' xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance' xsi:type='xs:string'>1020</saml2:AttributeValue></saml2:Attribute></saml2:AttributeStatement><saml2:AuthnStatement AuthnInstant='2016-07-13T19:29:50.446Z'><saml2:AuthnContext><saml2:AuthnContextClassRef>urn:be:fedict:eid:idp:AuthenticationWithIdentification</saml2:AuthnContextClassRef></saml2:AuthnContext></saml2:AuthnStatement></saml2:Assertion></wst:RequestedSecurityToken></wst:RequestSecurityTokenResponse></wst:RequestSecurityTokenResponseCollection>";
            var d = new XmlDocument();
            d.LoadXml(inf);
            var nsMan = new XmlNamespaceManager(d.NameTable);
            nsMan.AddNamespace("trust", "http://docs.oasis-open.org/ws-sx/ws-trust/200512");
            nsMan.AddNamespace("saml2", "urn:oasis:names:tc:SAML:2.0:assertion");
            var parentNodes = "trust:RequestSecurityTokenResponseCollection/trust:RequestSecurityTokenResponse/trust:RequestedSecurityToken/";
            var assertionNode = d.SelectSingleNode(parentNodes + "saml2:EncryptedAssertion", nsMan);
            if (assertionNode == null)
            {
                assertionNode = d.SelectSingleNode(parentNodes + "saml2:Assertion", nsMan);
            }

            var claims = new List<Claim>();
            foreach(XmlNode child in assertionNode.ChildNodes)
            {
                if (child.Name == "saml2:Subject" || child.Name == "saml:Subject")
                {
                    claims.Add(new Claim("sub", child.InnerText));
                }
                
                if (child.Name == "saml2:AttributeStatement"
                    || child.Name == "saml:AttributeStatement")
                {
                    foreach (XmlNode attribute in child.ChildNodes)
                    {
                        var id = string.Empty;
                        foreach(XmlAttribute metadata in attribute.Attributes)
                        {
                            if (metadata.Name == "Name")
                            {
                                id = metadata.Value;
                            }
                        }

                        claims.Add(new Claim(id, attribute.InnerText));
                    }
                }
            }

            
            System.Console.ReadLine();
            /*
            var httpClient = new HttpClient();
            WsFedMetadataRetriever.GetFederationMetataData("https://www.e-contract.be/eid-idp/endpoints/ws-federation/metadata/auth-ident-metadata.xml", httpClient);
            System.Console.ReadLine();
            */
        }
    }
}
